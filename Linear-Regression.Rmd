---
title: "Linear-Regression"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#??ֽ?ʼ?

---

##Example

```{r}
#????????
x <- c(170,168,175,153,185,135,172)
y <- c(61,57,58,40,90,35,68)
plot(x,y)#??ɢ??ͼ
z <- lm(y~x+1)#??ʾ?ع飬???ؾ???

abline(z)#???????????ߣ????????Ļử??ѵ��???ķ?Χ
lines(x,fitted(z))#??????????Ҳ???ԣ?????ѵ��???ķ?Χ?ڻ?

summary(z)#???ع?????????Ҫ??ϵ???ġ?*????????Rƽ?????Լ?????ģ??F??????pֵ
plot(z)#??????ͼ

model.matrix(z)#??????????��??ʽ????????????һ??Ϊ1??????��Ϊ??????��

names(z)#?鿴ģ???а?��??????????

w <- lm(y~x-1)#??ʾ??ԭ????ģ??
summary(w)#???ع?????
```

* residuals: ?в?????????<br>
* coefficients: ?ع鷽?̵?ϵ?????Լ???????ϵ???ı?׼?tֵ??pֵ<br>
* F-statistic: ????ֵ<br>
* signif: ?????Ա???<br>
    * " *** ": ????????<br>
    * " ** " : ?߶?????<br>
    * " * "  : ????<br>
    * " ?? "  : ??̫????<br>
    * "   "  : ??????<br>

```{r}
deviance(z)#?????в?ƽ????
residuals(z)#????ÿ?????Ĳв????һ????��

#????ѵ��????Ԥ??ֵ
yhat <- predict(z)
#Ԥ????ֵ
a <- data.frame(x=185)#?????ݿ?????
predict(z,a)#Ԥ??????ֵ
predict(z,a,interval = "prediction",level = 0.95)#Ԥ????ֵ???Լ?????

predict(z,interval = "confidence")#??y?ľ?ֵԤ??
predict(z,interval = "prediction")#??y??ֵԤ??

coef(z)#????????ģ?͵?ϵ??,Ϊnumeric?ͣ????Լ?[1],[2]?????ø???ϵ??

formula(z)#??ȡģ?͹?ʽ
```

---

##??Ԫ???Իع?ģ??
* ???????ݼ?swiss
```{r}
str(swiss)#?鿴??????
#????ģ??
swiss.lm=lm(Fertility~.,data = swiss)
summary(swiss.lm)
#??��ѡ??
swiss.lm1=update(swiss.lm,.~.+I(Education^2))#????Education^2
summary(swiss.lm1)

swiss.lm2=update(swiss.lm,.~.-Education)#??ɾ??Education
summary(swiss.lm2)

```

---

##?𲽻ع?
* step()????
    ** step(z,direction=" ")
    ** forward: ??ǰ???뷨
    ** backward: ???????뷨
    ** both: ????????
* ??ֱ?ӻع?һ????��???б?��??ģ?ͣ?Ȼstep()????ʱĬ????AIC׼??ѡ??ģ?ͣ????ȿ????????Զ????𲽻ع?ģ?ͣ?????ģ?Ͳ????⣬??Ȼ?????Լ????���?????ӱ?��??ɾ????��?ȣ?????ʱ?õĺ?????
    ** add(object,scope,...)
    ** drop(object,scope,...)
    ** ???Ͽ??Բ鿴???ӻ???ɾ????��??AIC׼?????α仯

```{r}
swiss.lmstep=step(swiss.lm)#?鿴֮???Լ????ƹ?ʽ????????
summary(swiss.lmstep)

swiss.lmstepBest=lm(formula = Fertility ~ Agriculture + Education + Catholic + Infant.Mortality, data = swiss)#?ó??Լ???Ҫ??ģ??
summary(swiss.lmstep)
#???????б?��???ӻ???ɾ??,
drop1(swiss.lmstep)#??ʱ?????Լ??жϣ??ж?????֮????Ҫ?Լ???????lm???????ϳ??µ?ģ??
add1(swiss.lm,~I(Education^2)+.)#????һ??Education??ƽ?? 

#??AIC׼???Ƚ϶???ģ??
AIC(swiss.lm,swiss.lm1,swiss.lm2)

```

---

##?ع?????
###??̫?ֲ????飺shapiro.test()
```{r}
plot(residuals(swiss.lm))
shapiro.test(residuals(swiss.lm))#?????в???̫?ֲ?
```

---

###???в?ͼ
```{r}
y.res <- resid(swiss.lm)#ͬresiduals()
y.fit <- predict(swiss.lm)#????????ֵ
plot(y.res~y.fit)

#????Ҳ???ԣ?
plot(swiss.lm$residuals~swiss$Fertility)
```

---

###????׼???в?
```{r}
y.rst <- rstandard(swiss.lm)
plot(y.rst~y.fit)

```

---

###?任
```{r}
lm.new <- update(swiss.lm,sqrt(.)~.)#??yȡ????
coef(lm.new)#ȡ????????ģ?͵?ϵ??

```

---

###???ع????Եļ??飺kappa(z,exact=FALSE,...)
* ????zһ???þ???????δ????????cor(data.frame),data.frame??Ϊ???ֱ?��???????????ݿ?
* exact=TRUEʱ??ʾ???㾫ȷ????????
* k<100,???ع?????С
* 100??k??1000,???ع????Խ?ǿ
* k??1000 ???ع?????????
* ?ҳ???Щ???ع????ԣ?xx=cor(data.frame);eign(xx)#????????

---

###????????ģ?ͣ?glm()

    fitted.model <- glm(formula,family = family.generator,data = data.frame)

    ??logisti?ع?
    fm <- glm(formula,family = binomial(link=logit),data = data.frame)??????link=logitʱ??????ֵΪ???ʣ???????????ֵΪlogitֵ

#The Book

##Library
```{r}
#a very large collection of data sets and functions
library(MASS)

#indludes the data associated with the following
library(ISLR)
```

##Simple Linear Regression
```{r}
#use the Boston data set included in MASS library
str(Boston)#?鿴????????
fix(Boston)#????ֱ?۵Ĳ鿴???ݼ?
names(Boston)#?鿴???ݼ??ĸ?????��??
#???????лع?
lm.fit=lm(medv~lstat,data = Boston)#medvΪ????��??lstatΪ?Ա?��?????????Իع?
lm.fit#?鿴?ع?????
summary(lm.fit)#?鿴??ϸ?ع?????
names(lm.fit)#?鿴?ع?֮?????õ?????
coef(lm.fit)#?鿴??��ϵ??
confint(lm.fit)#?Ա?��ϵ???????????��?
#prediction()???Բ???confidence interval??prediction interval
predict(lm.fit,data.frame(lstat=c(5,10,15)),interval = "confidence")
predict(lm.fit,data.frame(lstat=c(5,10,15)),interval = "prediction")
#??ͼ
plot(Boston$lstat,Boston$medv)#????ɢ??ͼ
abline(lm.fit)#????????ֱ?ߣ?abline(a,b)??ʾ?????ؾ?Ϊa??б??Ϊb??ֱ??

par(mfrow = c(2,2))
plot(lm.fit)


#?????в?
residuals(lm.fit)#????ÿ????????????ֵ?Ĳ???в?
rstudent(lm.fit)#???ض?Ӧ?ı?׼???в?

#?????в?ͼ
par(mfrow=c(1,1))
plot(predict(lm.fit),residuals(lm.fit))#?????в?ͼ
plot(predict(lm.fit),rstudent(lm.fit))#??????׼???в?ͼ

#leverage statistics
hatvalues(lm.fit)#????ÿһ????????hatvalues

plot(hatvalues(lm.fit))
which.max(hatvalues(lm.fit))#????index
```

##Multiple Linear Regression
```{r}
lm.fitm <- lm(medv~lstat+age,data = Boston)
summary(lm.fitm)

#ȫ????��?ع?
lm.fitall <- lm(medv~.,data = Boston)
summary(lm.fitall)
summary(lm.fitall)$r.sq#?????ع?ģ?͵?Rƽ??

library(car)#Ϊ????vif()????
vif(lm.fitall)#?????ݼ???vif???Ƚ?С

#????ע?⵽age??pֵ?Ƚϴ??????޳?
lm.fit1 <- lm(medv~.-age,data = Boston)
summary(lm.fit1)
#???߿?????update��??
lm.fit1 <- update(lm.fit,~.-age)
summary(lm.fit1)
```

##Interaction Terms
```{r}
summary(lm(medv~lstat*age,data = Boston))#??һ???н??????Ļع?
```

##Non-linear Transformations of the Predictors
???õ??η???ʱ????ҪI()<br>
```{r}
lm.fit2 <- lm(medv~lstat+I(lstat^2),data = Boston)
summary(lm.fit2)
```
we use the anova() function to further quantify the extent to which the quadratic fit is superior to the linear fit<br>

```{r}
anova(lm.fit,lm.fit2)
dev.new()
plot(medv~lstat,data = Boston)
abline(lm.fit,lwd=3)
abline(lm.fit2)
#anova() perform a hypothesis test comparing the two #models.ԭ??????��??ģ??ͬ???ã???????????full model???ֺ?,????lm.fit??
```

???ڸ??ߴεĻع飬??????poly()????<br>
use the poly() function to create the polynomial within lm()
```{r}
lm.fit3 <- lm(medv~poly(lstat,5),data = Boston)#??5?ζ???ʽ?ع?
summary(lm.fit3)
#??y??һ??logtransformation
summary(lm(medv~log(rm),data = Boston))
```

##Qualitative Predicors
```{r}
library(ISLR)
str(Carseats)
fix(Carseats)
names(Carseats)#?鿴????

lm.fit4 <- lm(Sales~.+Income:Advertising+Price:Age,data = Carseats)
summary(lm.fit4)

contrasts(Carseats$ShelveLoc)#return the coding that R uses for the dummy variables
```



