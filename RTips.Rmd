---
title: "RTips"
author: "jsysley"
date: "2016年9月18日"
output: html_document
---

#三个数据集：<br>
```{r}
#自带数据集
str(women)
str(uspop)
str(Titanic)
```

---

##names(),class(),head(),tail()
```{r}
library(MASS)
data("Insurance")#获取数据集
str(Insurance)#查看数据集
names(Insurance)#查看数据集的变量名字
head(names(Insurance),n=2)#仅列出前面两个变量名字
tail(names(Insurance),n=2)#仅列出后面两个变量名字
head(Insurance$Holders,n=2)#仅列出前面两个数据
```

---

###通过系列函数as.numeric(),as.integer(),as.logical(),as.character()
强制数据转换

---

###通过系列函数is.numeric(),is.integer(),is.logical(),is.character()来判断数据类型，返回布尔值

---

#数据抽样
用到base软件包的sample()函数，以及sampling包的strata(),cluster()函数

##简单随机抽样：sample()
sample(x,size,replace=FALSE,prob=NULL)<br>
* 其中x表示带抽取对象，一般用向量表示；size为非负整数，抽取的样本个数，replace表示是否为有放回抽样，prob设置抽取各样本的概率，默认等概率

例如对于一个数据集Insurance，可以如下方式抽样：
```{r}
str(Insurance)
sub1=sample(nrow(Insurance),10,replace = TRUE)#抽取index来获取样本
sub2=Insurance[sub1,]#通过index获取样本
```

下面演示用prob时向量怎么写，最后一条样本概率为1，其他样本概率为0
```{r}
sub3=sample(nrow(Insurance),10,replace = TRUE,prob = c(rep(0,nrow(Insurance)-1),1))#prob的向量长度要注意

sub4=Insurance[sub3,]#抽取数据
```

---

##分层抽样：strata()
strata(data,stratanames=NULL,size,method=c("srswor","srswr","poission","systematic",pik,description=FALSE))
* 其中，data为待抽数据集；stratanames中为分层所依据的变量名称；size为抽取的各层的样本数（顺序与数据集改变量的水平出现顺序一致；method为抽样方法，分别为无放回，有放回，泊松，系统抽样，默认srswor；pik设置各层中各样本的概率；description选择是否输出含有各层基本信息的结果）

下面对数据集Insurance按照District变量为分层变量来抽样，1-4个街区分别抽取1-4个样本

```{r}
library(sampling)
sub5=strata(Insurance,stratanames="District",size=c(1,2,3,4),method="srswor")
sub5
#其中第一列为样本所在数据集的行号，最后一列为所在层数，Prob为所在层数的抽样概率
#通过getdata()函数获取分层抽样的数据
getdata(Insurance,sub5)
```

---

##整群抽样：cluster()
cluster(data,clustername,size,method=c("srswor","srswr","poisson","systematic"),pik,description=FALSE)
* 其中，data为待抽数据集；size为抽取的样本数；method为抽样方法，分别为无放回，有放回，泊松，系统抽样，默认srswor；pik设置各层中各样本的概率；description选择是否输出含有各层基本信息的结果）；clustername指定用来划分群的变量名称

```{r}
str(Insurance)
#共抽取2个整群，所含样本数为32个
sub6=cluster(Insurance,clustername = "District",size = 2,method = "srswor",description = TRUE)
#显示抽样结果,抽中的District取值为2，3的两个整群，共四个群，每个群抽中的概率0.5
sub6
#拿到数据
getdata(Insurance,sub6)
```

---

##划分训练集与测试集
以Insurance数据集为例，无放回方式抽取3/4的样本作为训练集，剩下1/4为测试集

```{r}
train_sub=sample(nrow(Insurance),3/4*nrow(Insurance))#抽取行号
train_data=Insurance[train_sub,]#拿取数据作为训练集
test_data=Insurance[-train_sub,]#拿取剩下的数据作为测试集
```


#探索性数据分析

用到Hmisc()包：describe()

fBasics包的basicStats()

timeDate包的skewness(),kurtosis()

##变量概况
```{r}
attributes(Insurance)#查看数据属性列表
str(Insurance)#查看数据集结构
names(Insurance)#列出数据集的各个变量的名字
summary(Insurance)#查看数据集各变量的一系列统计指标值
```

用Hmisc包的describe()函数查看变量概况，会给出样本总个数(n)，缺失样本数(missing)，水平个数(unique)

```{r}
library(Hmisc)
describe(Insurance)
```

```{r}
library(fBasics)
basicStats(Insurance$Holders)
```

计算峰度和偏度，这两个指标值可以通过basicStats()函数得到，也可以用以下方法得到
```{r}
library(timeDate)
skewness(Insurance[,4:5])#计算偏度
kurtosis(Insurance[,4:5])#计算峰度
```

###稀疏性
用Matrix包来探究，为R中最著名的稀疏矩阵包，其提供的函数主要用于处理高密度矩阵或者稀疏矩阵

下面生产一个10*10的数据矩阵，100个元素，只有10个元素随机取1
```{r}
library(Matrix)
i=sample(1:10,10,replace=TRUE)#在1到10有放回取10个数，作为数据集中非空元素的行号
j=sample(1:10,10,replace=TRUE)#在1到10中有放回的取10个数，作为数据集中非空元素的列号
(A=sparseMatrix(i,j,x=1))#对i行j列的元素取值1，其余为空,生成稀疏矩阵A
```

###缺失值观察
用mice包的md.pattern()函数来获取其中的缺失值得分布情况

```{r}
library(mice)
a=rep(1,10)
a[2:3]=c(NA,NA)
b=rep(2,10)
b[3:4]=c(NA,NA)
c=cbind(a,b)
md.pattern(c)
```
其中1表示该变量取值中无缺失值，0表示有缺失值。左侧数字表示对应行的数据样例的个数，如7表示a,b均无缺失值的样本个数为7个，以此类推

###相关性
cor()函数<br>
下面演示计算Insurance集中Holders和Claims两个变量的相关系数

```{r}
cor(Insurance$Holders,Insurance$Claims)
```

下面以rattle包中的weather数据集说明处理过程
```{r}
library(rattle)
data(weather)#获取数据集
str(weather)#查看数据集
#绘图之前，先计算得到相关系数矩阵
var=c(12:21)#设置所选12-21列的变量
cor_matrix=cor(weather[var],use="pairwise")#计算相关系数矩阵
cor_matrix#显示
```

下面用Ellipse包中的plotcorr()来绘图
```{r}
library(ellipse)
plotcorr(cor_matrix,col=rep(c("white","black"),5))#对如上相关系数矩阵画图
```
圆形宽窄表示相关性大小，越窄相关性越高，方向为相关性的正负。在plotorr()函数中加上参数type=lower则只显示下三角图（图是对称的，简洁）

